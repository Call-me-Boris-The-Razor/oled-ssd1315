# Команды контроллера SSD1315

Справочник по командам контроллера SSD1315/SSD1306.

---

## I2C протокол

### Формат пакета

```text
┌──────────────┬─────────────┬────────────────────┐
│  I2C Address │ Control Byte│   Data/Command     │
│   (7 bit)    │  (1 byte)   │   (1+ bytes)       │
└──────────────┴─────────────┴────────────────────┘
```

### Control Byte

| Значение | Co | D/C# | Описание |
|----------|----|----- |----------|
| `0x00` | 0 | 0 | Команда (один или несколько байт) |
| `0x40` | 0 | 1 | Данные (пакетный режим для GDDRAM) |
| `0x80` | 1 | 0 | Команда, за которой следуют другие команды |
| `0xC0` | 1 | 1 | Данные, за которыми следуют другие данные |

---

## Основные команды

### Управление дисплеем

| Команда | Код | Параметры | Описание |
|---------|-----|-----------|----------|
| Display OFF | `0xAE` | — | Выключить дисплей (режим сна) |
| Display ON | `0xAF` | — | Включить дисплей |
| Set Contrast | `0x81` | 1 байт (0x00–0xFF) | Установить контраст |
| Entire Display RAM | `0xA4` | — | Вывод из RAM |
| Entire Display ON | `0xA5` | — | Все пиксели включены (тест) |
| Normal Display | `0xA6` | — | Нормальный режим |
| Inverse Display | `0xA7` | — | Инвертировать цвета |

### Адресация памяти

| Команда | Код | Параметры | Описание |
|---------|-----|-----------|----------|
| Set Memory Mode | `0x20` | 1 байт | Режим адресации |
| Set Column Address | `0x21` | 2 байта (start, end) | Диапазон колонок |
| Set Page Address | `0x22` | 2 байта (start, end) | Диапазон страниц |

#### Режимы адресации (параметр для 0x20)

| Значение | Режим | Описание |
|----------|-------|----------|
| `0x00` | Horizontal | Последовательно по строкам (используется в библиотеке) |
| `0x01` | Vertical | Последовательно по столбцам |
| `0x02` | Page | Постраничный режим (по умолчанию) |

### Конфигурация оборудования

| Команда | Код | Параметры | Описание |
|---------|-----|-----------|----------|
| Set Start Line | `0x40–0x7F` | — | Начальная строка (0–63) |
| Set Segment Remap 0 | `0xA0` | — | Column 0 → SEG0 |
| Set Segment Remap 127 | `0xA1` | — | Column 127 → SEG0 (отзеркаливание X) |
| Set MUX Ratio | `0xA8` | 1 байт (15–63) | Количество строк - 1 |
| Set COM Scan Inc | `0xC0` | — | COM0 → COM[N-1] |
| Set COM Scan Dec | `0xC8` | — | COM[N-1] → COM0 (отзеркаливание Y) |
| Set Display Offset | `0xD3` | 1 байт (0–63) | Вертикальное смещение |
| Set COM Pins | `0xDA` | 1 байт | Конфигурация COM |

#### Значения COM Pins (параметр для 0xDA)

| Значение | Конфигурация |
|----------|--------------|
| `0x02` | Sequential, Disable remap |
| `0x12` | Alternative (128×64), Disable remap |
| `0x22` | Sequential, Enable remap |
| `0x32` | Alternative, Enable remap |

### Тайминги

| Команда | Код | Параметры | Описание |
|---------|-----|-----------|----------|
| Set Clock Div | `0xD5` | 1 байт | [7:4]=частота, [3:0]=делитель |
| Set Precharge | `0xD9` | 1 байт | [7:4]=phase2, [3:0]=phase1 |
| Set VCOM Deselect | `0xDB` | 1 байт | Уровень VCOMH |

### Charge Pump

| Команда | Код | Параметры | Описание |
|---------|-----|-----------|----------|
| Set Charge Pump | `0x8D` | 1 байт | Управление DC-DC |

| Значение | Действие |
|----------|----------|
| `0x10` | Отключить charge pump |
| `0x14` | Включить charge pump |

### Скроллинг

| Команда | Код | Описание |
|---------|-----|----------|
| Deactivate Scroll | `0x2E` | Остановить скроллинг |
| Activate Scroll | `0x2F` | Запустить скроллинг |

---

## Последовательность инициализации

Библиотека выполняет следующую последовательность:

```text
1. Display OFF (0xAE)
2. Set Clock Div (0xD5, 0x80)
3. Set MUX Ratio (0xA8, height-1)
4. Set Display Offset (0xD3, 0x00)
5. Set Start Line (0x40)
6. Set Charge Pump (0x8D, 0x14 для internal)
7. Set Memory Mode (0x20, 0x00 = Horizontal)
8. Set Segment Remap (0xA1 или 0xA0)
9. Set COM Scan (0xC8 или 0xC0)
10. Set COM Pins (0xDA, 0x12 для 128×64)
11. Set Contrast (0x81, 0x7F)
12. Set Precharge (0xD9, 0xF1)
13. Set VCOM Deselect (0xDB, 0x40)
14. Deactivate Scroll (0x2E)
15. Entire Display RAM (0xA4)
16. Normal Display (0xA6)
17. Display ON (0xAF)
```

---

## Организация памяти (GDDRAM)

### Структура для 128×64

```text
┌─────────────────────────────────────────────────┐
│ Page 0: строки 0–7   (128 байт)                 │
├─────────────────────────────────────────────────┤
│ Page 1: строки 8–15  (128 байт)                 │
├─────────────────────────────────────────────────┤
│ Page 2: строки 16–23 (128 байт)                 │
├─────────────────────────────────────────────────┤
│ ...                                             │
├─────────────────────────────────────────────────┤
│ Page 7: строки 56–63 (128 байт)                 │
└─────────────────────────────────────────────────┘

Всего: 8 страниц × 128 колонок = 1024 байта
```

### Формат байта

```text
Каждый байт = 8 вертикальных пикселей
LSB (bit 0) = верхний пиксель страницы
MSB (bit 7) = нижний пиксель страницы

Пример: байт 0x81 = 10000001
  bit 7: ■  (нижний)
  bit 6: □
  bit 5: □
  bit 4: □
  bit 3: □
  bit 2: □
  bit 1: □
  bit 0: ■  (верхний)
```

---

## Horizontal Addressing Mode

Режим, используемый библиотекой для эффективной заливки буфера.

```text
Порядок записи:
  Col 0, Page 0 → Col 1, Page 0 → ... → Col 127, Page 0 →
  Col 0, Page 1 → Col 1, Page 1 → ... → Col 127, Page 1 →
  ...
  Col 0, Page 7 → ... → Col 127, Page 7

После Col 127, Page N автоматически переходит на Col 0, Page N+1
```

---

## Ссылки

- [SSD1315 Datasheet](https://www.solomon-systech.com/product/ssd1315/)
- [SSD1306 Datasheet](https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf) (совместим)
